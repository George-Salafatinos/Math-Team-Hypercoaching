{% extends "base.html" %}

{% block content %}
<h2>Event Details</h2>
<p><strong>Name:</strong> {{ event.eventName }}</p>
<p><strong>ID:</strong> {{ event.id }}</p>

<hr>
<!-- Single Student Score -->
<h3>Upload a Single Student's Score</h3>
<form action="{{ url_for('upload_single_student_score', meet_id=meet_id, event_id=event.id) }}"
      method="POST" enctype="multipart/form-data" class="mb-4">
  
  <!-- Student Info -->
  <div class="row mb-3">
    <div class="col">
      <label>Student Name:</label>
      <input type="text" name="studentName" class="form-control" required>
    </div>
    <div class="col">
      <label>Grade Level:</label>
      <select name="gradeLevel" class="form-select">
        <option value="freshman">freshman</option>
        <option value="sophomore">sophomore</option>
        <option value="junior">junior</option>
        <option value="senior">senior</option>
      </select>
    </div>
  </div>

  <!-- Score Mode: manual or image -->
  <label class="form-label">How will you provide score data?</label>
  <div class="mb-3">
    <select name="scoreMode" class="form-select" id="scoreModeSelect" onchange="toggleScoreMode()">
      <option value="manual">Enter manually</option>
      <option value="image">Parse from Image (GPT) [Experimental, unreliable results]</option>
    </select>
  </div>

  <!-- If user chooses 'image', show file input -->
  <div id="imageFields"  style="display: none;">
    <label>Answer Sheet Image (for GPT parse):</label>
    <input type="file" name="scoreFile" class="form-control">
  </div>

  <!-- If user chooses 'manual', show manual inputs -->
  <div id="manualFields">
    <div class="mb-3">
      <label for="totalQuestions">Total Questions:</label>
      <input type="number" min="1" name="totalQuestions" id="totalQuestions" class="form-control">
    </div>
    <div class="mb-3">
      <label for="incorrectList">Which Questions Were Incorrect? (comma-separated):</label>
      <input type="text" name="incorrectList" id="incorrectList" class="form-control" placeholder="e.g. 3,7,10">
    </div>
  </div>

  <button type="submit" class="btn btn-secondary mt-3">Submit Single Student Score</button>
</form>

<script>
  function toggleScoreMode() {
    const mode = document.getElementById("scoreModeSelect").value;
    const imageFields = document.getElementById("imageFields");
    const manualFields = document.getElementById("manualFields");
    
    if (mode === "manual") {
      imageFields.style.display = "none";
      manualFields.style.display = "block";
    } else {
      imageFields.style.display = "block";
      manualFields.style.display = "none";
    }
  }
</script>

<hr>

<h3>Participants</h3>
{% if event.participants %}
  <ul class="list-group">
    {% for p in event.participants %}
      <li class="list-group-item d-flex justify-content-between align-items-center">
        <div>
          <strong>{{ p.studentName }} ({{ p.gradeLevel }})</strong>
          <br>
          Correct: {{ p.correctQuestions|length }} 
          | Incorrect: {{ p.incorrectQuestions|length }}
        </div>
        <form action="{{ url_for('remove_participant', meet_id=meet_id, event_id=event.id) }}" method="POST">
          <input type="hidden" name="studentName" value="{{ p.studentName }}">
          <input type="hidden" name="gradeLevel" value="{{ p.gradeLevel }}">
          <button type="submit" class="btn btn-danger btn-sm"
                  onclick="return confirm('Remove this participant?')">
            Remove
          </button>
        </form>
      </li>
    {% endfor %}
  </ul>
{% else %}
  <p>No participants yet.</p>
{% endif %}
{% endblock %}
