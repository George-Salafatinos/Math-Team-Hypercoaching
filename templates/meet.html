{% extends "base.html" %}

{% block content %}
<h2>Meet Details</h2>
<p><strong>Title:</strong> {{ meet.title }}</p>
<p><strong>ID:</strong> {{ meet.id }}</p>

<hr>
<!-- Create Event -->
<a class="btn btn-primary mb-3" href="{{ url_for('create_event_route', meet_id=meet.id) }}">Create a New Event</a>

<h3>Events in this Meet:</h3>
{% if meet.events %}
  <ul class="list-group">
    {% for event in meet.events %}
      <li class="list-group-item d-flex justify-content-between align-items-center">
        <div>
          <a href="{{ url_for('view_event', meet_id=meet.id, event_id=event.id) }}">
            {{ event.eventName }}
          </a>
        </div>
        <!-- Optional delete button -->
        <form action="{{ url_for('remove_event', meet_id=meet.id, event_id=event.id) }}" method="POST" class="ms-3">
          <button type="submit" class="btn btn-danger btn-sm"
                  onclick="return confirm('Delete this event?')">
            Delete
          </button>
        </form>
      </li>
    {% endfor %}
  </ul>
{% else %}
  <p>No events yet.</p>
{% endif %}

<hr>
<!-- Upload Topic List -->
<h3>Upload Topic List</h3>
<form action="{{ url_for('upload_topic_list', meet_id=meet.id) }}" method="POST" enctype="multipart/form-data" class="mb-3">
  <div class="mb-3">
    <input type="file" name="files" multiple class="form-control">
  </div>
  <button type="submit" class="btn btn-secondary">Submit Topic List</button>
</form>

<hr>
<!-- Show the parsed topic list in a table below the events -->
{% if meet.topicList and meet.topicList|length > 0 %}
  <h3>Parsed Topics</h3>
  <div class="table-responsive">
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Subject</th>
          <th>Topics</th>
        </tr>
      </thead>
      <tbody>
      {% for subject, topics in meet.topicList.items() %}
        <tr>
          <td>{{ subject }}</td>
          <td>
            {% for t in topics %}
              <span class="badge bg-info text-dark me-1">{{ t }}</span>
            {% endfor %}
          </td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
{% else %}
  <p>No parsed topic list yet.</p>
{% endif %}
{% endblock %}
